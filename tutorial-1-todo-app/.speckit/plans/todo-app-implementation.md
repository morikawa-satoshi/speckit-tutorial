# ToDoアプリ 技術実装計画 (Plan)

## 全体アーキテクチャ
```
index.html   ── UI構造
styles.css   ── スタイル/レイアウト
app.js       ── 状態管理・ロジック・イベント
localStorage ── 永続化（ブラウザのみ）
```

## ファイル構成
```

├── index.html        # HTML骨組み・主要要素
├── styles.css        # リセット/レイアウト/コンポーネント/状態
├── app.js            # 状態管理・描画・イベント
└── .speckit/         # 仕様関連
```

## データモデル / 状態
- Task: `{ id, text, completed, createdAt }`
- State: `{ tasks: Task[], filter: 'all' | 'active' | 'completed' }`
- Storage Key: `todo-app-tasks`

## HTML設計 (index.html)
- ヘッダ: タイトル
- 入力フォーム: テキスト入力 + 追加ボタン（Enter対応）
- フィルタバー: すべて / 未完了 / 完了済み（`data-filter`）
- タスクリスト: `<ul>` に `<li>` を動的挿入（チェック/テキスト/削除ボタン）
- フッタ: 未完了件数表示
- `meta viewport` でレスポンシブ

## CSS方針 (styles.css)
- リセット/ベース: 余白リセットと `box-sizing: border-box;`
- レイアウト: 最大幅コンテナ、センタリング、余白トークン化
- コンポーネント: 入力行、ボタン、フィルタ、リスト、削除ボタン
- 状態: `completed` クラスで取り消し線・彩度低下
- インタラクション: フォーカスリング、ホバー/アクティブの視覚フィードバック
- レスポンシブ: 600px未満で縦積み、ボタン幅100%

## JavaScript設計 (app.js)
### 状態と永続化
- `state.tasks` を単一ソースにし、変更後 `render()` と `save()` を実行
- `load()` で JSON パース失敗時は空配列にフォールバック

### 関数群
- 永続化: `load()` / `save()` / `generateId()`
- タスク操作: `addTask(text)` / `toggleTask(id)` / `deleteTask(id)` / `getFilteredTasks(filter)`
- UI: `renderTasks()` / `renderCount()` / `setActiveFilter(filter)` / `clearInput()` / `showError(msg)`

### イベントハンドリング
- 追加: フォーム submit / Enter キーで `addTask`
- トグル・削除: リストにイベント委譲（`data-id` で識別）
- フィルタ切替: `data-filter` ボタンで状態更新
- バリデーション: trim必須、空/200文字超は拒否し短いエラー表示

### レンダリング戦略
- 変更差分の最小更新を意識（必要に応じて DocumentFragment）
- 初期ロードで `load()` → `render()` を実行

## LocalStorageの扱い
- キー: `todo-app-tasks`
- 変更毎に即 `save()`、ロード時は存在確認と例外捕捉
- 利用不可時は警告表示し非永続モードで継続

## 実装ステップ
1) HTML骨組み: 入力・フィルタ・リスト・件数表示、viewport設定
2) CSS: リセット → レイアウト → コンポーネント → 状態/フォーカス → レスポンシブ
3) JS初期化: state定義、DOM参照取得、`load()`、イベント登録、初回 `render()`
4) 機能: 追加/トグル/削除/フィルタ、件数表示、バリデーション
5) 永続化とエラー処理: save/load 例外、壊れたデータは空配列に再初期化
6) アクセシビリティ: フォーカスリング、ARIAラベル（削除ボタン等）、キーボード操作確認
7) テスト: 追加/削除/トグル/フィルタ/リロード保持、100件程度で性能確認

## エッジケースと対策
- LocalStorage未対応/拒否: バナーやメッセージで通知し非永続で動作
- データ破損: パース失敗時に空配列で再初期化
- 文字数超過・空入力: 追加を拒否し簡潔なエラー表示
- ストレージ容量超過: 例外捕捉しユーザーに通知、操作は継続

## パフォーマンス
- DOM参照をキャッシュし、イベント委譲でリスナ数を削減
- 差分更新を意識し再描画を最小化
- JSONシリアライズは必要最小限に抑制

## アクセシビリティ
- セマンティックHTML（ボタン/ul/li）と適切なラベル
- フォーカス可視化、キーボード操作（Tab/Enter/Space）
- 件数更新など動的情報は必要に応じて aria-live を検討

## テスト計画
- 手動チェック: 追加/空入力拒否/完了トグル/削除/フィルタ/リロード保持
- データ破損・LocalStorage不可・100件規模での動作確認
- キーボード操作とスクリーンリーダー簡易確認

## デプロイメモ
- ビルド不要の静的ファイル。任意の静的ホスティング（GitHub Pages等）で配信可能

## 成功基準
- 追加/完了トグル/削除/フィルタが仕様どおり動作
- リロード後もデータが保持（LocalStorage有効時）
- キーボード操作とフォーカスリングが機能
- スマホ幅でもUIが崩れない
